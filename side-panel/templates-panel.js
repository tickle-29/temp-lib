"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.TemplatesPanel=void 0;const react_1=__importDefault(require("react")),mobx_react_lite_1=require("mobx-react-lite"),core_1=require("@blueprintjs/core"),nanoid_1=require("nanoid"),l10n_1=require("../utils/l10n"),images_grid_1=require("./images-grid"),api_1=require("../utils/api"),use_api_1=require("../utils/use-api"),useChange=(e,t)=>{const a=react_1.default.useRef(!0);react_1.default.useEffect((()=>{a.current?a.current=!1:e()}),t)},Templates=(0,mobx_react_lite_1.observer)((({sizeQuery:e,query:t,store:a})=>{const{setQuery:r,loadMore:i,hasMore:s,data:l,isLoading:n,reset:o,error:c}=(0,use_api_1.useInfiniteAPI)({getAPI:({page:t,query:a})=>(0,api_1.templateList)({page:t,query:a,sizeQuery:e}),getSize:e=>e.totalPages});return useChange((()=>{o()}),[e]),useChange((()=>{r(t)}),[t]),react_1.default.createElement(images_grid_1.ImagesGrid,{images:null==l?void 0:l.map((e=>e.items)).flat(),getPreview:e=>e.preview,isLoading:n,onSelect:async e=>{const t=await fetch(e.json),r=await t.json();if(a.pages.length<=1)a.loadJSON(r,!0);else{const e=JSON.parse(JSON.stringify(a.toJSON()));e.width===r.width&&e.height===r.height||r.pages.forEach((e=>{e.width=e.width||r.width,e.height=e.height||r.height})),r.pages.forEach((e=>{e.id=(0,nanoid_1.nanoid)(10),e.children.forEach((e=>{e.id=(0,nanoid_1.nanoid)(10)}))}));const t=a.pages.indexOf(a.activePage);e.pages.splice(t,1,...r.pages),a.loadJSON(e,!0)}},loadMore:s&&i,error:c})}));exports.TemplatesPanel=(0,mobx_react_lite_1.observer)((({store:e})=>{const[t,a]=react_1.default.useState(!0),[r,i]=react_1.default.useState(""),s=t?`${e.width}x${e.height}`:"all";return react_1.default.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column"}},react_1.default.createElement(core_1.InputGroup,{leftIcon:"search",placeholder:(0,l10n_1.t)("sidePanel.searchPlaceholder"),onChange:e=>{i(e.target.value)},style:{marginBottom:"20px"}}),react_1.default.createElement(core_1.Switch,{checked:t,onChange:e=>{a(e.target.checked)},alignIndicator:core_1.Alignment.RIGHT,style:{marginTop:"8px",marginBottom:"25px"}},(0,l10n_1.t)("sidePanel.searchTemplatesWithSameSize")," "),react_1.default.createElement(Templates,{store:e,sizeQuery:"size="+s,query:r}))}));