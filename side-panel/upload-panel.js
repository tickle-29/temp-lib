"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.UploadPanel=exports.setUploadFunc=void 0;const react_1=__importDefault(require("react")),core_1=require("@blueprintjs/core"),image_1=require("../utils/image"),file_1=require("../utils/file"),images_grid_1=require("./images-grid"),l10n_1=require("../utils/l10n"),image_2=require("../utils/image");let uploadFunc=async e=>(0,file_1.localFileToURL)(e);function setUploadFunc(e){uploadFunc=e}exports.setUploadFunc=setUploadFunc;let filesCache=[];const UploadPanel=({store:e})=>{const[t,a]=react_1.default.useState(filesCache),[i,l]=react_1.default.useState(!1),n=react_1.default.useRef(null);return react_1.default.useEffect((()=>{filesCache=t}),[t]),react_1.default.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column"}},react_1.default.createElement("div",{style:{height:"45px",paddingTop:"5px"}},(0,l10n_1.t)("sidePanel.uploadTip")),react_1.default.createElement("div",{style:{marginBottom:"20px"}},react_1.default.createElement("label",{htmlFor:"input-file"},react_1.default.createElement(core_1.Button,{icon:"upload",style:{width:"100%"},onClick:()=>{var e;null===(e=n.current)||void 0===e||e.click()}},(0,l10n_1.t)("sidePanel.uploadImage")),react_1.default.createElement("input",{type:"file",ref:n,style:{display:"none"},onChange:async e=>{const{target:t}=e;l(!0);for(const e of t.files){const t=await uploadFunc(e);a((e=>e.concat([t])))}l(!1),t.value=""},multiple:!0}))),react_1.default.createElement(images_grid_1.ImagesGrid,{images:t,isLoading:i,getPreview:e=>e,onSelect:async(t,a,i)=>{var l;let{width:n,height:r}=await(0,image_1.getImageSize)(t);const c=t.indexOf("svg+xml")>=0||t.indexOf(".svg")>=0?"svg":"image";if(i&&"svg"===i.type&&i.contentEditable&&"image"===c)return void i.set({maskSrc:t});if(i&&"image"===i.type&&i.contentEditable&&"image"==c){const e=(0,image_2.getCrop)(i,{width:n,height:r});return void i.set(Object.assign({src:t},e))}const o=Math.min(e.width/n,e.height/r,1);n*=o,r*=o;const s=((null==a?void 0:a.x)||e.width/2)-n/2,u=((null==a?void 0:a.y)||e.height/2)-r/2;null===(l=e.activePage)||void 0===l||l.addElement({type:c,src:t,x:s,y:u,width:n,height:r})}}))};exports.UploadPanel=UploadPanel;