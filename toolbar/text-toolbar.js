"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.TextToolbar=exports.SpacingInput=exports.FontColorInput=exports.FontStyleGroup=exports.FontSizeInput=exports.FontFamilyInput=void 0;const react_1=__importDefault(require("react")),mobx_react_lite_1=require("mobx-react-lite"),core_1=require("@blueprintjs/core"),popover2_1=require("@blueprintjs/popover2"),react_window_1=require("react-window"),swr_1=__importDefault(require("swr")),fonts_1=require("../utils/fonts"),api_1=require("../utils/api"),use_api_1=require("../utils/use-api"),color_picker_1=__importDefault(require("./color-picker")),filters_picker_1=__importDefault(require("./filters-picker")),element_container_1=require("./element-container"),MdcFormatLineSpacing_1=__importDefault(require("@meronex/icons/mdc/MdcFormatLineSpacing")),styled_1=__importDefault(require("../utils/styled")),MdcFormatVerticalAlignTop_1=__importDefault(require("@meronex/icons/mdc/MdcFormatVerticalAlignTop")),MdcFormatVerticalAlignCenter_1=__importDefault(require("@meronex/icons/mdc/MdcFormatVerticalAlignCenter")),MdcFormatVerticalAlignBottom_1=__importDefault(require("@meronex/icons/mdc/MdcFormatVerticalAlignBottom")),l10n_1=require("../utils/l10n"),flags_1=require("../utils/flags"),Image=(0,styled_1.default)("img")`
  height: 20px;

  .bp4-dark & {
    filter: invert(1);
  }
`,googleFonts=(0,fonts_1.getFontsList)(),FontItem=({fontFamily:e,handleClick:t,modifiers:n,store:r,isCustom:o})=>{const[a,l]=react_1.default.useState(!o);react_1.default.useEffect((()=>{a||r.loadFont(e)}),[e,a]);const i=a?react_1.default.createElement(Image,{src:(0,api_1.getGoogleFontImage)(e),alt:e,onError:()=>{l(!1)}}):e;return react_1.default.createElement(core_1.MenuItem,{text:i,active:n.active,disabled:n.disabled,onClick:t,style:{fontFamily:'"'+e+'"'}})},SearchInput=({onChange:e,defaultValue:t})=>{const n=react_1.default.useRef(null);return react_1.default.useEffect((()=>{n.current&&n.current.focus()}),[]),react_1.default.createElement(core_1.InputGroup,{leftIcon:"search",inputRef:n,defaultValue:t,onChange:t=>e(t.target.value)})},FontMenu=({store:e,fonts:t,activeFont:n,activeFontLabel:r,onFontSelect:o})=>{const[a,l]=react_1.default.useState(""),i=t.filter((e=>e.toLowerCase().indexOf(a.toLowerCase())>=0));return react_1.default.createElement(popover2_1.Popover2,{content:react_1.default.createElement("div",null,react_1.default.createElement(SearchInput,{onChange:e=>l(e),defaultValue:a}),react_1.default.createElement("div",{style:{paddingTop:"5px"}},react_1.default.createElement(react_window_1.FixedSizeList,{innerElementType:react_1.default.forwardRef(((e,t)=>react_1.default.createElement(core_1.Menu,Object.assign({ref:t},e)))),height:Math.min(400,30*i.length)+10,width:210,itemCount:i.length,itemSize:30,children:({index:t,style:r})=>{const a=i[t];return react_1.default.createElement("div",{style:r},react_1.default.createElement(FontItem,{key:a,fontFamily:a,modifiers:{active:n===a},handleClick:()=>o(a),store:e,isCustom:e.fonts.find((e=>e.fontFamily===a))||fonts_1.globalFonts.find((e=>e.fontFamily===a))}))}})))},react_1.default.createElement(core_1.Button,{text:r,rightIcon:"caret-down",minimal:!0,style:{marginRight:"5px",fontFamily:'"'+n+'"',overflow:"hidden",whiteSpace:"nowrap",maxHeight:"30px"}}))};exports.FontFamilyInput=(0,mobx_react_lite_1.observer)((({elements:e,store:t})=>{const{data:n,mutate:r}=(0,swr_1.default)((0,api_1.getGoogleFontsListAPI)(),use_api_1.fetcher,{isPaused:()=>(0,fonts_1.isGoogleFontChanged)(),fallbackData:[]});react_1.default.useEffect((()=>{r()}),[(0,fonts_1.isGoogleFontChanged)()]);const o=t.fonts.concat(fonts_1.globalFonts).map((e=>e.fontFamily)).concat((null==n?void 0:n.length)&&!(0,fonts_1.isGoogleFontChanged)()?n:googleFonts);let a=e[0].fontFamily;return a.length>15&&(a=a.slice(0,15)+"..."),react_1.default.createElement(FontMenu,{fonts:o,activeFont:e[0].fontFamily,activeFontLabel:a,store:t,onFontSelect:n=>{t.history.transaction((()=>{e.forEach((e=>{e.set({fontFamily:n})}))}))}})})),exports.FontSizeInput=(0,mobx_react_lite_1.observer)((({elements:e,store:t})=>react_1.default.createElement(core_1.NumericInput,{onValueChange:n=>{t.history.transaction((()=>{e.forEach((e=>{e.set({fontSize:n,width:Math.max(n,e.width)})}))}))},value:Math.round(e[0].fontSize),style:{width:"50px"},min:5,max:4*t.height})));const ALIGN_OPTIONS=["left","center","right","justify"],VERTICAL_ALIGN_OPTIONS=["top","middle","bottom"],VERTICAL_ALIGN_ICONS={top:react_1.default.createElement(MdcFormatVerticalAlignTop_1.default,null),middle:react_1.default.createElement(MdcFormatVerticalAlignCenter_1.default,null),bottom:react_1.default.createElement(MdcFormatVerticalAlignBottom_1.default,null)};exports.FontStyleGroup=(0,mobx_react_lite_1.observer)((({elements:e,store:t})=>{const n=e[0];return react_1.default.createElement(core_1.ButtonGroup,null,react_1.default.createElement(core_1.Button,{minimal:!0,icon:"align-"+n.align,onClick:()=>{const r=(ALIGN_OPTIONS.indexOf(n.align)+1+ALIGN_OPTIONS.length)%ALIGN_OPTIONS.length,o=ALIGN_OPTIONS[r];t.history.transaction((()=>{e.forEach((e=>{e.set({align:o})}))}))}}),flags_1.flags.textVerticalResizeEnabled&&react_1.default.createElement(core_1.Button,{minimal:!0,icon:VERTICAL_ALIGN_ICONS[n.verticalAlign],onClick:()=>{const r=(VERTICAL_ALIGN_OPTIONS.indexOf(n.verticalAlign)+1+VERTICAL_ALIGN_OPTIONS.length)%VERTICAL_ALIGN_OPTIONS.length,o=VERTICAL_ALIGN_OPTIONS[r];t.history.transaction((()=>{e.forEach((e=>{e.set({verticalAlign:o})}))}))}}),react_1.default.createElement(core_1.Button,{minimal:!0,icon:"bold",active:"bold"===n.fontWeight||"700"===n.fontWeight,onClick:()=>{const r="bold"===n.fontWeight||"700"===n.fontWeight;t.history.transaction((()=>{e.forEach((e=>{r?e.set({fontWeight:"normal"}):e.set({fontWeight:"bold"})}))}))}}),react_1.default.createElement(core_1.Button,{minimal:!0,icon:"italic",active:"italic"===n.fontStyle,onClick:()=>{t.history.transaction((()=>{e.forEach((e=>{"italic"===n.fontStyle?e.set({fontStyle:"normal"}):e.set({fontStyle:"italic"})}))}))}}),react_1.default.createElement(core_1.Button,{minimal:!0,icon:"underline",active:n.textDecoration.indexOf("underline")>=0,onClick:()=>{let r=n.textDecoration.split(" ");r.indexOf("underline")>=0?r=r.filter((e=>"underline"!==e)):r.push("underline"),t.history.transaction((()=>{e.forEach((e=>{e.set({textDecoration:r.join(" ")})}))}))}}))})),exports.FontColorInput=(0,mobx_react_lite_1.observer)((({elements:e,store:t})=>react_1.default.createElement(color_picker_1.default,{value:e[0].fill,style:{marginRight:"5px"},gradientEnabled:!0,onChange:n=>t.history.transaction((()=>{e.forEach((e=>{e.set({fill:n})}))})),store:t}))),exports.SpacingInput=(0,mobx_react_lite_1.observer)((({elements:e,store:t})=>{const n=e[0];return react_1.default.createElement(popover2_1.Popover2,{content:react_1.default.createElement("div",{style:{padding:"15px 25px",width:"200px"}},react_1.default.createElement("p",null,(0,l10n_1.t)("toolbar.lineHeight")),react_1.default.createElement(core_1.Slider,{value:"number"==typeof n.lineHeight?100*n.lineHeight:120,labelStepSize:50,onChange:n=>{t.history.transaction((()=>{e.forEach((e=>{e.set({lineHeight:n/100})}))}))},min:50,max:250,stepSize:10,showTrackFill:!0}),react_1.default.createElement("p",null,(0,l10n_1.t)("toolbar.letterSpacing")),react_1.default.createElement(core_1.Slider,{value:100*n.letterSpacing,labelStepSize:50,onChange:n=>{t.history.transaction((()=>{e.forEach((e=>{e.set({letterSpacing:n/100})}))}))},min:-50,max:250,stepSize:10,showTrackFill:!1})),position:core_1.Position.BOTTOM},react_1.default.createElement(core_1.Button,{icon:react_1.default.createElement(MdcFormatLineSpacing_1.default,{className:"bp4-icon",style:{fontSize:"20px"}}),minimal:!0}))}));const PROPS_MAP={TextFontFamily:exports.FontFamilyInput,TextFontSize:exports.FontSizeInput,TextFontVariant:exports.FontStyleGroup,TextFilters:filters_picker_1.default,TextFill:exports.FontColorInput,TextSpacing:exports.SpacingInput};exports.TextToolbar=(0,mobx_react_lite_1.observer)((({store:e,hideTextFontFamily:t,hideTextEffects:n,hideTextSpacing:r,hideTextBold:o,hideTextItalic:a,hideTextUnderline:l,components:i})=>{const c=e.selectedElements,s=["TextFill",!t&&"TextFontFamily","TextFontSize","TextFontVariant",!r&&"TextSpacing",!n&&"TextFilters"].filter((e=>!!e)),u=(0,element_container_1.extendToolbar)({type:"text",usedItems:s,components:i});return react_1.default.createElement(element_container_1.ElementContainer,{items:u,itemRender:t=>{const n=i[t]||PROPS_MAP[t];return react_1.default.createElement(n,{elements:c,element:c[0],store:e,key:t,hideTextBold:o,hideTextItalic:a,hideTextUnderline:l})}})})),exports.default=exports.TextToolbar;