"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.useInfiniteAPI=exports.fetcher=void 0;const react_1=__importDefault(require("react")),infinite_1=__importDefault(require("swr/infinite")),fetcher=e=>fetch(e).then((e=>e.json()));exports.fetcher=fetcher;const useInfiniteAPI=({defaultQuery:e="",timeout:t=100,getAPI:r,getSize:i=(e=>e.total_pages)})=>{var u;const n=react_1.default.useRef(e),a=react_1.default.useRef(),{data:o,error:s,size:l,setSize:f,mutate:c}=(0,infinite_1.default)((e=>r({query:n.current,page:e+1})),exports.fetcher,{revalidateAll:!1}),d=!o&&!s||!!(l>0&&o&&void 0===o[l-1]),_=0===(null===(u=null==o?void 0:o[0])||void 0===u?void 0:u.length)||o&&o[0]&&i(o[0])===l;return{setQuery:react_1.default.useCallback((e=>{n.current=e,clearTimeout(a.current),a.current=setTimeout((()=>{c()}),t)}),[t]),isLoading:d,loadMore:()=>{_||f(l+1)},isReachingEnd:_,data:null==o?void 0:o.filter((e=>e)),items:null==o?void 0:o.reduce(((e,t)=>e.concat(t)),[]),hasMore:!_,reset:c,error:s}};exports.useInfiniteAPI=useInfiniteAPI;